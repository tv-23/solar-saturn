---
import "../../public/style/message.css";
---
<script src="https://cdn.jsdelivr.net/npm/emailjs-com@3.2.0/dist/email.min.js"></script>

<div class="chat-container hidden" id="chat-box">
  <div class="chat-header">
    <button class="close-btn" id="closeChat">
      <i class="bi bi-x"></i>
    </button>
    <p style="margin:0;">SEATRUST Assistant</p>
  </div>

  <div class="chat-body" id="chatBody">
    <div class="message-row receiver">
      <div class="message-bubble">
        âš“ Bienvenue chez <strong>SEATRUST</strong>.<br>
        Nous sommes un Groupement dâ€™IntÃ©rÃªt Ã‰conomique spÃ©cialisÃ© dans les
        solutions logistiques et maritimes intÃ©grÃ©es.<br><br>
        Comment puis-je vous aider aujourdâ€™hui ?
        <div class="quick-replies">
          <div class="quick-reply" data-reply="Services">DÃ©couvrir nos services</div>
          <div class="quick-reply" data-reply="Tarifs">Demander un devis</div>
          <div class="quick-reply" data-reply="Portfolio">Nos opÃ©rations</div>
          <div class="quick-reply" data-reply="Contact">Parler Ã  un conseiller</div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function () {

  const chatBox = document.getElementById("chat-box");
  const closeChat = document.getElementById("closeChat");
  const chatBody = document.getElementById("chatBody");
  const chatBtn = document.getElementById("chat-button");

  const AI_RESPONSES = {
    greeting: [
      "Bonjour ğŸ‘‹, bienvenue chez SEATRUST. Comment puis-je vous assister ?",
      "âš“ Bonjour ! SEATRUST vous accompagne avec des solutions maritimes et logistiques sur mesure.",
    ],

    services: `SEATRUST propose des services maritimes et logistiques intÃ©grÃ©s :<br><br>
    â€¢ ğŸš¢ Transport maritime & affrÃ¨tement de navires<br>
    â€¢ âš“ Agence maritime & courtage de navires<br>
    â€¢ ğŸ—ï¸ Manutention portuaire & stevedoring<br><br>
    ğŸ‘‰ Quel service vous intÃ©resse ?`,

    SeaTransport: `ğŸš¢ <strong>Transport maritime & affrÃ¨tement</strong><br><br>
    â€¢ AffrÃ¨tement de navires (complet ou partiel)<br>
    â€¢ Solutions adaptÃ©es Ã  votre type de cargaison<br>
    â€¢ Optimisation des coÃ»ts et dÃ©lais<br><br>
    ğŸ‘‰ Souhaitez-vous une estimation personnalisÃ©e ?`,

    ShippingAgency: `âš“ <strong>Agence maritime & courtage</strong><br><br>
    â€¢ ReprÃ©sentation de navires dans les ports<br>
    â€¢ Coordination des escales et formalitÃ©s<br>
    â€¢ Courtage entre armateurs et affrÃ©teurs<br><br>
    ğŸ‘‰ Voulez-vous Ãªtre contactÃ© pour plus de dÃ©tails ?`,

    TerminalHandling: `ğŸ—ï¸ <strong>Manutention portuaire & stevedoring</strong><br><br>
    â€¢ Chargement & dÃ©chargement de navires<br>
    â€¢ Gestion des opÃ©rations terminales<br>
    â€¢ SÃ©curitÃ© et conformitÃ© portuaire<br><br>
    ğŸ‘‰ Avez-vous une opÃ©ration spÃ©cifique Ã  nous confier ?`,

    pricing: `Nos prestations sont proposÃ©es Ã  des tarifs compÃ©titifs, calculÃ©s sur mesure selon :<br>
    â€¢ Type de cargaison<br>
    â€¢ ItinÃ©raire maritime<br>
    â€¢ Nature des opÃ©rations portuaires<br><br>
    ğŸ‘‰ Souhaitez-vous recevoir un devis personnalisÃ© ?`,

    portfolio: `Nous opÃ©rons sur diffÃ©rents types de flux maritimes et logistiques.<br>
    ğŸ‘‰ Souhaitez-vous voir un exemple liÃ© Ã  votre activitÃ© ?`,

    contact: `TrÃ¨s bien. Pour vous orienter vers le bon interlocuteur, merci de prÃ©ciser votre demande.`,

    default: [
      "Pouvez-vous prÃ©ciser votre besoin logistique ou maritime ?",
      "Je suis Ã  votre disposition pour toute question liÃ©e au transport maritime.",
      "Souhaitez-vous Ãªtre mis en relation avec un conseiller SEATRUST ?",
    ],
  };

  if (chatBtn) {
    chatBtn.addEventListener("click", (e) => {
      e.preventDefault();
      chatBox.classList.toggle("hidden");
    });
  }

  closeChat.addEventListener("click", () => chatBox.classList.add("hidden"));

  function addMessage(text, sender) {
    const row = document.createElement("div");
    row.className = `message-row ${sender === "user" ? "sender" : "receiver"}`;
    const bubble = document.createElement("div");
    bubble.className = "message-bubble";
    bubble.innerHTML = text;
    row.appendChild(bubble);
    chatBody.appendChild(row);
    chatBody.scrollTop = chatBody.scrollHeight;
  }

  function showTyping() {
    const row = document.createElement("div");
    row.id = "typing";
    row.className = "message-row receiver";
    row.innerHTML = `<div class="typing-indicator"><div></div><div></div><div></div></div>`;
    chatBody.appendChild(row);
    chatBody.scrollTop = chatBody.scrollHeight;
  }

  function hideTyping() {
    document.getElementById("typing")?.remove();
  }

  function aiResponse(msg) {
    const m = msg.toLowerCase();
    let response = "";

    if (["bonjour","salut","hello"].some(w => m.includes(w))) {
      response = AI_RESPONSES.greeting[Math.floor(Math.random()*2)];
    } 
    else if (m.includes("service")) response = AI_RESPONSES.services;
    else if (m.includes("transport")) response = AI_RESPONSES.SeaTransport;
    else if (m.includes("agence") || m.includes("courtage")) response = AI_RESPONSES.ShippingAgency;
    else if (m.includes("manutention") || m.includes("stevedoring")) response = AI_RESPONSES.TerminalHandling;
    else if (m.includes("tarif") || m.includes("devis")) response = AI_RESPONSES.pricing;
    else if (m.includes("opÃ©ration")) response = AI_RESPONSES.portfolio;
    else if (m.includes("contact")) response = AI_RESPONSES.contact;
    else response = AI_RESPONSES.default[Math.floor(Math.random()*3)];

    addMessage(response, "ai");
    addQuickReplies(msg);
  }

  const quickReplies = {
    default: ["DÃ©couvrir nos services", "Demander un devis", "Parler Ã  un conseiller"],
    Services: ["Transport maritime", "Agence maritime", "Manutention portuaire"],
    Tarifs: ["Demander un devis"],
  };

  function addQuickReplies(context) {
    let list = quickReplies.default;
    if (context === "Services") list = quickReplies.Services;
    if (context === "Tarifs") list = quickReplies.Tarifs;

    const container = document.createElement("div");
    container.className = "quick-replies";

    list.forEach(t => {
      const b = document.createElement("div");
      b.className = "quick-reply";
      b.textContent = t;
      b.onclick = () => {
        addMessage(t, "user");
        showTyping();
        setTimeout(() => {
          hideTyping();
          aiResponse(t);
        }, 1200);
      };
      container.appendChild(b);
    });

    chatBody.lastElementChild.appendChild(container);
  }

  document.querySelectorAll(".quick-reply").forEach(btn => {
    btn.addEventListener("click", function () {
      const text = this.dataset.reply;
      addMessage(text, "user");
      showTyping();
      setTimeout(() => {
        hideTyping();
        aiResponse(text);
      }, 1000);
    });
  });

});
</script>
  